<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ollama IntelliProxy by T.Weber</title>
    
    <!-- Custom Meta-Tags für den Monitor -->
    <meta name="application-name" content="Ollama Intelli Proxy">
    <meta name="application-description" content="Intelligent routing proxy for Ollama LLMs with performance-based model selection and fallback configuration.">
    <meta name="application-category" content="AI/ML">   
     <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #fafafa;
            color: #333;
            line-height: 1.6;
        }
        
        /* Minimal sticky header */
        header {
            position: sticky;
            top: 0;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #eee;
            padding: 12px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }
        header h1 { font-size: 18px; font-weight: 500; color: #333; }
        header .status { font-size: 12px; color: #10b981; }
        
        /* Minimal nav */
        nav {
            display: flex;
            gap: 8px;
        }
        nav a {
            padding: 6px 12px;
            font-size: 13px;
            color: #666;
            text-decoration: none;
            border-radius: 4px;
            transition: all 0.2s;
        }
        nav a:hover, nav a.active { background: #f0f0f0; color: #333; }
        
        /* Sections */
        section {
            padding: 40px 24px;
            max-width: 900px;
            margin: 0 auto;
            border-bottom: 1px solid #eee;
        }
        section:last-child { border-bottom: none; }
        section h2 {
            font-size: 14px;
            font-weight: 500;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 20px;
        }
        
        /* Cards */
        .card {
            background: #fff;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
        }
        .card h3 { font-size: 14px; font-weight: 500; margin-bottom: 8px; }
        .card p { font-size: 13px; color: #666; }
        
        /* Grid */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
        }
        
        /* Stats */
        .stat { font-size: 24px; font-weight: 300; color: #333; }
        .stat-label { font-size: 12px; color: #999; }
        
        /* Code */
        pre {
            background: #f5f5f5;
            padding: 12px;
            border-radius: 6px;
            font-size: 12px;
            overflow-x: auto;
            border: 1px solid #eee;
        }
        code { font-family: 'Monaco', monospace; }
        
        /* Buttons */
        .btn {
            display: inline-block;
            padding: 8px 16px;
            background: #333;
            color: #fff;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }
        .btn:hover { background: #555; }
        
        /* Tables */
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #eee; }
        th { font-weight: 500; color: #999; }
        
        /* Forms */
        input, select, textarea {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
            width: 100%;
            max-width: 300px;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #999;
        }
        
        /* Footer */
        footer {
            padding: 24px;
            text-align: center;
            font-size: 12px;
            color: #999;
        }
        
        /* Responsive */
        @media (max-width: 600px) {
            header { flex-direction: column; gap: 8px; }
            nav { flex-wrap: wrap; justify-content: center; }
            section { padding: 24px 16px; }
            .grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <header>
        <h1>Ollama Router</h1>
        <nav>
            <a href="#status">Status</a>
            <a href="#models">Models</a>
            <a href="#stats">Statistics</a>
            <a href="#config">Config</a>
            <a href="#api">API</a>
            <a href="#debug">Debug</a>
        </nav>
    </header>

    <section id="status">
        <h2>Status</h2>
        <div class="grid">
            <div class="card">
                <div class="stat" id="total-requests">-</div>
                <div class="stat-label">Total Requests</div>
            </div>
            <div class="card">
                <div class="stat" id="models-count">-</div>
                <div class="stat-label">Models Available</div>
            </div>
            <div class="card">
                <div class="stat" id="router-status" style="color:#10b981;">●</div>
                <div class="stat-label">Router Status</div>
            </div>
        </div>
    </section>

    <section id="models">
        <h2>Available Models</h2>
        <div class="card" style="margin-bottom:16px;">
            <p><strong>Ollama API:</strong> <code id="ollama-url">http://HOST_IP:11434</code></p>
            <p><strong>Router API:</strong> <code id="router-url">http://HOST_IP:9998</code></p>
        </div>
        <div id="models-list" class="grid"></div>
    </section>

    <section id="stats">
        <h2>Statistics</h2>
        <div class="card">
            <h3>Usage by Model</h3>
            <table id="model-stats">
                <thead><tr><th>Model</th><th>Requests</th><th>Avg Time (s)</th><th>%</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
        <div class="card">
            <h3>Categories</h3>
            <table id="category-stats">
                <thead><tr><th>Category</th><th>Requests</th><th>%</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
        <div class="card">
            <h3>Performance Metrics</h3>
            <table id="metrics-stats">
                <thead><tr><th>Model</th><th>Avg Response Time</th><th>Speed</th><th>Complexity</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </section>

    <section id="config">
        <h2>Fallback Configuration</h2>
        <div class="card">
            <p style="margin-bottom:12px;">Timeout: <span id="timeout-value">300</span>s</p>
            <div id="fallback-list"></div>
        </div>
    </section>

    <section id="api">
        <h2>API Reference</h2>
        <div class="card" style="margin-bottom:16px;">
            <p><strong>Base URL:</strong> <code id="api-base-url">http://HOST_IP:9998</code></p>
        </div>
        
        <!-- Health Check -->
        <div class="card">
            <h3>Health Check</h3>
            <p style="font-size:12px;color:#666;margin-bottom:8px;">Check router and Ollama status</p>
            <pre>GET /health</pre>
            <p style="font-size:11px;color:#999;margin-top:8px;">Example:</p>
            <pre style="margin-top:4px;">curl -s http://localhost:9998/health</pre>
        </div>
        
        <!-- Get Models -->
        <div class="card">
            <h3>Get All Models</h3>
            <p style="font-size:12px;color:#666;margin-bottom:8px;">List all available models with attributes (speed, complexity)</p>
            <pre>GET /models</pre>
            <p style="font-size:11px;color:#999;margin-top:8px;">Example:</p>
            <pre style="margin-top:4px;">curl -s http://localhost:9998/models</pre>
        </div>
        
        <!-- Get Models by Category -->
        <div class="card">
            <h3>Get Models by Category</h3>
            <p style="font-size:12px;color:#666;margin-bottom:8px;">List models in a specific category</p>
            <pre>GET /models/{category}</pre>
            <p style="font-size:11px;color:#999;margin-top:8px;">Example:</p>
            <pre style="margin-top:4px;">curl -s http://localhost:9998/models/general</pre>
        </div>
        
        <!-- Process Task -->
        <div class="card">
            <h3>Process Task</h3>
            <p style="font-size:12px;color:#666;margin-bottom:8px;">Process a task with intelligent routing. Auto-classifies if task_type is null.</p>
            <pre>POST /task
{
  "prompt": "Your prompt here",
  "task_type": null,  // auto-classify
  "stream": false
}</pre>
            <p style="font-size:11px;color:#999;margin-top:8px;">Example:</p>
            <pre style="margin-top:4px;">curl -s -X POST http://localhost:9998/task \
  -H "Content-Type: application/json" \
  -d '{"prompt":"Hello","task_type":"general"}'</pre>
        </div>
        
        <!-- Classify Only -->
        <div class="card">
            <h3>Classify Only</h3>
            <p style="font-size:12px;color:#666;margin-bottom:8px;">Just classify a task without executing</p>
            <pre>POST /classify
{
  "prompt": "Your prompt here",
  "task_type": null,
  "stream": false
}</pre>
            <p style="font-size:11px;color:#999;margin-top:8px;">Example:</p>
            <pre style="margin-top:4px;">curl -s -X POST http://localhost:9998/classify \
  -H "Content-Type: application/json" \
  -d '{"prompt":"Write code"}'</pre>
        </div>
        
        <!-- Get Statistics -->
        <div class="card">
            <h3>Get Statistics</h3>
            <p style="font-size:12px;color:#666;margin-bottom:8px;">Usage statistics including avg response time per model</p>
            <pre>GET /stats</pre>
            <p style="font-size:11px;color:#999;margin-top:8px;">Example:</p>
            <pre style="margin-top:4px;">curl -s http://localhost:9998/stats</pre>
        </div>
        
        <!-- Get Requests -->
        <div class="card">
            <h3>Get Request Log</h3>
            <p style="font-size:12px;color:#666;margin-bottom:8px;">Get last 50 requests with prompts and response times</p>
            <pre>GET /requests</pre>
            <p style="font-size:11px;color:#999;margin-top:8px;">Example:</p>
            <pre style="margin-top:4px;">curl -s http://localhost:9998/requests</pre>
        </div>
        
        <!-- Clear Requests -->
        <div class="card">
            <h3>Clear Request Log</h3>
            <p style="font-size:12px;color:#666;margin-bottom:8px;">Clear the request log</p>
            <pre>POST /requests/clear</pre>
            <p style="font-size:11px;color:#999;margin-top:8px;">Example:</p>
            <pre style="margin-top:4px;">curl -s -X POST http://localhost:9998/requests/clear</pre>
        </div>
        
        <!-- Get Fallbacks -->
        <div class="card">
            <h3>Get Fallback Config</h3>
            <p style="font-size:12px;color:#666;margin-bottom:8px;">Get model fallback configuration</p>
            <pre>GET /config/fallbacks</pre>
            <p style="font-size:11px;color:#999;margin-top:8px;">Example:</p>
            <pre style="margin-top:4px;">curl -s http://localhost:9998/config/fallbacks</pre>
        </div>
        
        <!-- Update Fallbacks -->
        <div class="card">
            <h3>Update Fallback Config</h3>
            <p style="font-size:12px;color:#666;margin-bottom:8px;">Update model fallback configuration</p>
            <pre>POST /config/fallbacks
{
  "fallbacks": {"model": "fallback"},
  "timeout": 300
}</pre>
        </div>
    </section>

    <section id="debug">
        <h2>Request Log (Last 50)</h2>
        <div class="card">
            <button class="btn" onclick="clearDebug()" style="margin-bottom:12px;">Clear Log</button>
            <table id="request-log">
                <thead><tr><th>Time</th><th>Model</th><th>Task Type</th><th>Response Time</th><th>Prompt</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </section>

    <footer>
        Ollama Router &middot; Intelligent LLM Dispatcher
    </footer>

    <script>
        // Router runs on port 9998, Dashboard on 9999
        const ROUTER_PORT = 9998;
        const STATIC_PORT = 9999;
        const HOST_IP = window.location.hostname;
        const API_URL = `http://${HOST_IP}:${ROUTER_PORT}`;
        const OLLAMA_PORT = 11434;
        
        // Update URL displays on page load
        document.addEventListener('DOMContentLoaded', () => {
            const ollamaUrl = document.getElementById('ollama-url');
            const routerUrl = document.getElementById('router-url');
            const apiBaseUrl = document.getElementById('api-base-url');
            if (ollamaUrl) ollamaUrl.textContent = `http://${HOST_IP}:${OLLAMA_PORT}`;
            if (routerUrl) routerUrl.textContent = `http://${HOST_IP}:${ROUTER_PORT}`;
            if (apiBaseUrl) apiBaseUrl.textContent = `http://${HOST_IP}:${ROUTER_PORT}`;
        });
        
        // Load data
        async function loadData() {
            try {
                const [statsRes, modelsRes, configRes, requestsRes] = await Promise.all([
                    fetch(API_URL + '/stats'),
                    fetch(API_URL + '/models'),
                    fetch(API_URL + '/config/fallbacks'),
                    fetch(API_URL + '/requests')
                ]);
                
                const stats = await statsRes.json();
                const models = await modelsRes.json();
                const config = await configRes.json();
                const requests = await requestsRes.json();
                
                // Update status
                document.getElementById('total-requests').textContent = stats.total_requests || 0;
                document.getElementById('models-count').textContent = models.total || 0;
                
                // Update models
                const modelsList = document.getElementById('models-list');
                modelsList.innerHTML = '';
                Object.entries(models.categories || {}).forEach(([cat, modelList]) => {
                    modelList.forEach(m => {
                        const div = document.createElement('div');
                        div.className = 'card';
                        div.innerHTML = `<h3>${m}</h3><p>${cat}</p>`;
                        modelsList.appendChild(div);
                    });
                });
                
                // Update model stats
                const modelStatsBody = document.querySelector('#model-stats tbody');
                modelStatsBody.innerHTML = '';
                const avgTimes = stats.model_avg_times || {};
                Object.entries(stats.models || {}).sort((a,b) => b[1].count - a[1].count).forEach(([model, data]) => {
                    const pct = stats.total_requests > 0 ? ((data.count / stats.total_requests) * 100).toFixed(1) : 0;
                    const avgTime = avgTimes[model] || 0;
                    modelStatsBody.innerHTML += `<tr><td>${model}</td><td>${data.count}</td><td>${avgTime}s</td><td>${pct}%</td></tr>`;
                });
                
                // Update metrics (performance by model with attributes)
                const metricsBody = document.querySelector('#metrics-stats tbody');
                metricsBody.innerHTML = '';
                Object.entries(models.models || {}).sort((a,b) => (b[1].speed || 0) - (a[1].speed || 0)).forEach(([model, data]) => {
                    const avgTime = avgTimes[model] || '-';
                    metricsBody.innerHTML += `<tr><td>${model}</td><td>${avgTime !== '-' ? avgTime + 's' : '-'}</td><td>${data.speed || '-'}/10</td><td>${data.complexity || '-'}/10</td></tr>`;
                });
                
                // Update category stats
                const catStatsBody = document.querySelector('#category-stats tbody');
                catStatsBody.innerHTML = '';
                Object.entries(stats.categories || {}).sort((a,b) => b[1] - a[1]).forEach(([cat, count]) => {
                    const pct = stats.total_requests > 0 ? ((count / stats.total_requests) * 100).toFixed(1) : 0;
                    catStatsBody.innerHTML += `<tr><td>${cat}</td><td>${count}</td><td>${pct}%</td></tr>`;
                });
                
                // Update fallback config
                document.getElementById('timeout-value').textContent = config.timeout || 300;
                const fallbackList = document.getElementById('fallback-list');
                fallbackList.innerHTML = '<table><thead><tr><th>Model</th><th>Fallback</th></tr></thead><tbody>';
                Object.entries(config.fallbacks || {}).forEach(([model, fallback]) => {
                    fallbackList.innerHTML += `<tr><td>${model}</td><td>${fallback}</td></tr>`;
                });
                fallbackList.innerHTML += '</tbody></table>';
                
                // Update request log
                const requestLogBody = document.querySelector('#request-log tbody');
                requestLogBody.innerHTML = '';
                (requests.recent || []).forEach(req => {
                    const time = req.timestamp ? new Date(req.timestamp).toLocaleTimeString() : '-';
                    requestLogBody.innerHTML += `<tr><td>${time}</td><td>${req.model_used || '-'}</td><td>${req.task_classification || '-'}</td><td>${req.execution_time ? req.execution_time + 's' : '-'}</td><td>${req.prompt || '-'}</td></tr>`;
                });
                
            } catch (e) {
                console.error('Error loading data:', e);
            }
        }
        
        // Clear debug log
        async function clearDebug() {
            try {
                await fetch(API_URL + '/requests/clear', { method: 'POST' });
                loadData();
            } catch (e) {
                console.error('Error clearing debug:', e);
            }
        }
        
        // Highlight active nav on scroll
        const sections = document.querySelectorAll('section');
        const navLinks = document.querySelectorAll('nav a');
        window.addEventListener('scroll', () => {
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (scrollY >= sectionTop - 100) {
                    current = section.getAttribute('id');
                }
            });
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + current) {
                    link.classList.add('active');
                }
            });
        });
        
        // Initial load
        loadData();
        setInterval(loadData, 5000);
    </script>
</body>
</html>
